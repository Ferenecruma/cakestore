{% extends "webstore/base.html" %}

{% block content %}
  <div class="subcatecogries">
    <div class="btn-group">
      {% for subcategory in subcategories %}
      <button class="btn-group__item btn-group__item">{{ subcategory.title}}</button>
      {% endfor %}
    </div>  
  </div>
  <div class="products">
    {% for product in products %}
    <div class="wrapper">
      <div class="product-container">
        <div class="top" style="
          background: url({{ product.photo.url }}) no-repeat center center;
          background-size: cover;">
        </div>
        <div class="bottom">
          <div class="left">
            <div class="details">
              <h1>{{ product.title }}</h1>
              <p>Â£{{ product.price }}</p>
            </div>
            <div id="{{ product.id }}" class="buy"><i class="fas fa-cart-plus"></i></div>
          </div>
          <div class="right">
            <div class="done"><i class="fas fa-check"></i></div>
            <div class="details">
              <h1>{{ product.title }}</h1>
              <p>Added to your cart</p>
            </div>
            <div id="{{ product.id }}" class="remove"><i class="fas fa-trash"></i></div>
          </div>
        </div>
      </div>
      <div class="inside">
        <div class="icon"><i class="fas fa-info-circle"></i></div>
        <div class="contents">
          <table>
            <tr>
              <th>Width</th>
              <th>Height</th>
            </tr>
            <tr>
              <td>3000mm</td>
              <td>4000mm</td>
            </tr>
            <tr>
              <th>Something</th>
              <th>Something</th>
            </tr>
            <tr>
              <td>200mm</td>
              <td>200mm</td>
            </tr>
            <tr>
              <th>Something</th>
              <th>Something</th>
            </tr>
            <tr>
              <td>200mm</td>
              <td>200mm</td>
            </tr>
            <tr>
              <th>Something</th>
              <th>Something</th>
            </tr>
            <tr>
              <td>200mm</td>
              <td>200mm</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    {% endfor %}

  
  {% csrf_token %}  

  <script>

    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    const buttons = document.querySelectorAll(".btn-group__item");
    buttons.forEach(button => {
      button.addEventListener("click",() => {
        // do some action according to button
        
        // show success feedback
        button.classList.add("btn-group__item--active");
        setTimeout(() => {
          button.classList.remove("btn-group__item--active");
        },600)
      })
    })

    async function postData(url = '', data = {}) {
    // Default options are marked with *
      const response = await fetch(url, {
        method: 'POST', // *GET, POST, PUT, DELETE, etc.
        mode: 'same-origin', // no-cors, *cors, same-origin
        headers: {
          'X-CSRFToken': csrftoken,
          'Content-Type': 'application/json',
          // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        // body: JSON.stringify(data)  body data type must match "Content-Type" header
      });
      return response.json(); // parses JSON response into native JavaScript objects
    }

    function add_item_to_cart(item_id){
      let url = "/cart/add/" + String(item_id) + "/";
      postData(url, {'data': 'somedata'}).then(data => {
      console.log(data); // JSON data parsed by `data.json()` call
      });
    }

    function delete_item_from_cart(item_id){
      let url = "/cart/remove/" + String(item_id) + "/";
      console.log(url)
      postData(url).then(data => {
      console.log(data); // JSON data parsed by `data.json()` call
      });
    }

    document.querySelector('.buy').addEventListener('click', () => {
      let bottom = document.querySelector('.bottom')
      let cart_icon = document.querySelector('.shopping-cart')
      
      add_item_to_cart(1)
      cart_icon.classList.add('shopping-cart-active')
      bottom.classList.add('clicked')
    });

    document.querySelector('.remove').addEventListener('click', () => {
      let bottom = document.querySelector('.bottom')
      delete_item_from_cart(1)
      bottom.classList.remove('clicked')
    });
  </script>
{% endblock content %}